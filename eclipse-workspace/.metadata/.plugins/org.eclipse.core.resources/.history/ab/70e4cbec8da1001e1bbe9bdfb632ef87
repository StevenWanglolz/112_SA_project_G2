package controller;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.json.JSONObject;

import app.PostHelper;
import tools.JsonReader;

/**
 * Servlet implementation class SearchController
 */
@WebServlet("/api/search.do")
public class SearchController extends HttpServlet {
	 private static final long serialVersionUID = 1L;
	       
	 private static PostHelper ph = PostHelper.getHelper();
	 private String test_string = "finance";
	 
	    /**
	     * @see HttpServlet#HttpServlet()
	     */
	    public SearchController() {
	        super();
	        // TODO Auto-generated constructor stub
	    }
	    

	 /**
	  * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	  */
	    protected void doGet(HttpServletRequest request, HttpServletResponse response)
	            throws ServletException, IOException {
	        JsonReader jsr = new JsonReader(request);
	        JSONObject jso = jsr.getObject();

			//String post_title = jso.getString("post_title");
	        String post_title = test_string;
	        
	        
	        if (post_title != null && !post_title.isEmpty()) {
	            JSONObject query = ph.getSearchPost(post_title);

	            JSONObject resp = new JSONObject();
	            resp.put("status", "200");
	            resp.put("message", "Search successful");
	            resp.put("response", query);

	            jsr.response(resp, response);
	        } else {
	            JSONObject resp = new JSONObject();
	            resp.put("status", "400");
	            resp.put("message", "Invalid search term");

	            jsr.response(resp, response);
	        }
	    }

	 /**
	  * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	  */
	 protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
	  // TODO Auto-generated method stub
	  doGet(request, response);
	 }

	}